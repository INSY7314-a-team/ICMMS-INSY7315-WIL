@* ==========================================================================
   QUOTE WIZARD (Bootstrap 5 modal with tabbed steps + sticky yellow footer)
   Now wired to API with debug logs (via pm-quote.js)
   ========================================================================== *@

<div class="modal fade" id="quoteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">

      <!-- HEADER -->
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-file-invoice"></i> Generate New Quote</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body" style="max-height:70vh; overflow-y:auto;">
        <!-- Tabs -->
        <ul class="nav nav-tabs" id="quoteTabs" role="tablist">
          <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-client">Client</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-blueprint">Blueprint</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-estimate">Estimate</button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-preview">Preview</button>
          </li>
        </ul>

        <!-- Tab Contents -->
        <div class="tab-content p-3">
          
          <!-- Client Tab -->
          <div class="tab-pane fade show active" id="tab-client">
            <div class="mb-3">
              <label for="q-title" class="form-label">Quote Title</label>
              <input id="q-title" class="form-control" placeholder="Enter quote title" />
            </div>
            <div class="mb-3">
              <label for="clientSelect" class="form-label">Select Client</label>
              <select id="clientSelect" class="form-select">
                <option value="">-- Loading clients... --</option>
              </select>
            </div>
            <button type="button" class="btn btn-primary" onclick="goTab('#tab-blueprint')">
              Next: Blueprint →
            </button>
          </div>

          <!-- Blueprint Tab -->
          <div class="tab-pane fade" id="tab-blueprint">
            <p class="text-muted">Attach or auto-generate a project blueprint.</p>
            <button type="button" class="btn btn-outline-primary" id="btn-mock-blueprint">
              Apply Mock Blueprint
            </button>
            <div class="mt-3">
              <button type="button" class="btn btn-secondary" onclick="goTab('#tab-client')">← Back</button>
              <button type="button" class="btn btn-primary" onclick="goTab('#tab-estimate')">Next: Estimate →</button>
            </div>
          </div>

          <!-- Estimate Tab -->
          <div class="tab-pane fade" id="tab-estimate">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <button type="button" class="btn btn-sm btn-outline-success" id="btn-add-labour">+ Labour</button>
                <button type="button" class="btn btn-sm btn-outline-info" id="btn-add-material">+ Material</button>
              </div>
              <div>
                <input id="est-markup" type="number" class="form-control d-inline w-auto" placeholder="Markup %" value="10" />
                <input id="est-tax" type="number" class="form-control d-inline w-auto" placeholder="Tax %" value="15" />
              </div>
            </div>

            <table class="table table-bordered table-sm">
              <thead class="table-light">
                <tr>
                  <th>Name</th>
                  <th>Qty</th>
                  <th>Unit</th>
                  <th>Unit Price</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="estimateTableBody"></tbody>
            </table>

            <div id="est-summary" class="fw-bold text-end text-muted small"></div>

            <div class="mt-3">
              <button type="button" class="btn btn-secondary" onclick="goTab('#tab-blueprint')">← Back</button>
              <button type="button" class="btn btn-primary" onclick="goTab('#tab-preview')">Next: Preview →</button>
            </div>
          </div>

          <!-- Preview Tab -->
          <div class="tab-pane fade" id="tab-preview">
            <div id="quotePreviewArea" class="border p-3 rounded bg-light">
              <em>Preview will be generated here...</em>
            </div>
            <div class="mt-3">
              <button type="button" class="btn btn-secondary" onclick="goTab('#tab-estimate')">← Back</button>
              <button type="button" class="btn btn-success" id="btn-submit-quote">
                ✅ Submit Quote to API
              </button>
            </div>
          </div>

        </div>
      </div>

      <!-- FOOTER (sticky, yellow) -->
      <div class="modal-footer d-flex justify-content-between"
           style="position: sticky; bottom: 0; background:#FFD200; border-top:2px solid #ccc; z-index: 1000;">
        <div class="fw-bold" id="estimateSubtotal">Subtotal: R 0</div>
        <div>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-dark" id="btn-finalize-quote">Finalize Quote</button>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  // === Tab navigation helper ===
  function goTab(target) {
    const tab = document.querySelector(`[data-bs-target="${target}"]`);
    if (tab) new bootstrap.Tab(tab).show();
  }

  console.log("[QuoteWizard] Modal + tabs wired up.");
</script>
