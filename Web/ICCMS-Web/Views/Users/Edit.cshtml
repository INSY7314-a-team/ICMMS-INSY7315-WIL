@model ICCMS_Web.Models.UserDto

@{
    ViewData["Title"] = "Edit User";
    Layout = "_Layout";
}

<div class="user-management-container">
    <!-- Header Section -->
    <div class="user-dashboard-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="user-dashboard-title">
                    <i class="fas fa-user-edit me-3"></i>Edit User
                </h1>
                <p class="user-dashboard-subtitle">Update user information and permissions</p>
            </div>
            <div>
                <a href="@Url.Action("Index", "Users")" class="user-btn user-btn-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Users
                </a>
            </div>
        </div>
    </div>

    <!-- User Info Card -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="stat-card">
                <div class="d-flex align-items-center">
                    <div class="user-avatar me-3" style="width: 60px; height: 60px; font-size: 24px;">
                        <span>@Model.FullName.Substring(0, Math.Min(2, Model.FullName.Length)).ToUpper()</span>
                    </div>
                    <div>
                        <h4 class="mb-1" style="color: #FFFFFF;">@Model.FullName</h4>
                        <p class="mb-0" style="color: rgba(255, 255, 255, 0.7);">@Model.Email</p>
                        <div class="mt-2">
                            @{
                                var roleBadgeClass = Model.Role?.ToLower() switch
                                {
                                    "admin" => "admin",
                                    "project manager" => "manager",
                                    "contractor" => "contractor",
                                    "client" => "client",
                                    _ => "admin"
                                };
                            }
                            <span class="user-badge @roleBadgeClass me-2">@Model.Role</span>
                            @if (Model.IsActive)
                            {
                                <span class="user-badge active">Active</span>
                            }
                            else
                            {
                                <span class="user-badge inactive">Inactive</span>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Form -->
    <div class="row">
        <div class="col-lg-8">
            <div class="user-form-container">
                <div class="user-form-header">
                    <h3 class="user-form-title">
                        <i class="fas fa-edit me-2"></i>User Information
                    </h3>
                </div>
                <div class="user-form-body">
                    <form asp-action="EditConfirmed" asp-route-id="@Model.UserId" method="post">
                        <input type="hidden" asp-for="UserId" />
                        <input type="hidden" asp-for="CreatedAt" />
                        <input type="hidden" asp-for="IsActive" />

                        <div asp-validation-summary="ModelOnly" class="user-alert user-alert-danger" role="alert"></div>

                        <!-- Personal Information Section -->
                        <div class="form-section mb-4">
                            <h5 class="section-title mb-3">
                                <i class="fas fa-user me-2"></i>Personal Information
                            </h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="FullName" class="user-form-label">
                                            <i class="fas fa-user me-1"></i>Full Name *
                                        </label>
                                        <input asp-for="FullName" class="user-form-control"
                                            placeholder="Enter full name" required />
                                        <span asp-validation-for="FullName" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="Email" class="user-form-label">
                                            <i class="fas fa-envelope me-1"></i>Email Address *
                                        </label>
                                        <input asp-for="Email" type="email" class="user-form-control"
                                            placeholder="Enter email address" required />
                                        <span asp-validation-for="Email" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="Phone" class="user-form-label">
                                            <i class="fas fa-phone me-1"></i>Phone Number
                                        </label>
                                        <input asp-for="Phone" type="tel" class="user-form-control"
                                            placeholder="Enter phone number" />
                                        <span asp-validation-for="Phone" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label asp-for="Role" class="user-form-label">
                                            <i class="fas fa-user-tag me-1"></i>Role *
                                        </label>
                                        <select asp-for="Role" class="user-form-select" required>
                                            <option value="">Select a role</option>
                                            <option value="Admin">Admin</option>
                                            <option value="Project Manager">Project Manager</option>
                                            <option value="Contractor">Contractor</option>
                                            <option value="Client">Client</option>
                                        </select>
                                        <span asp-validation-for="Role" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Security Section -->
                        <div class="form-section mb-4">
                            <h5 class="section-title mb-3">
                                <i class="fas fa-shield-alt me-2"></i>Security Settings
                            </h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="NewPassword" class="user-form-label">
                                            <i class="fas fa-lock me-1"></i>New Password
                                        </label>
                                        <input type="password" id="NewPassword" name="NewPassword"
                                            class="user-form-control" placeholder="Enter new password" />
                                        <div class="form-text" style="color: rgba(255, 255, 255, 0.7);">Leave blank to
                                            keep the current password.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="ConfirmNewPassword" class="user-form-label">
                                            <i class="fas fa-lock me-1"></i>Confirm New Password
                                        </label>
                                        <input type="password" id="ConfirmNewPassword" name="ConfirmNewPassword"
                                            class="user-form-control" placeholder="Confirm new password" />
                                        <span id="passwordMatchError" class="text-danger"
                                            style="display: none;">Passwords do not match.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="form-actions">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="form-info">
                                    <small style="color: rgba(255, 255, 255, 0.7);">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Last updated: @Model.CreatedAt.ToString("MMM dd, yyyy")
                                    </small>
                                </div>
                                <div class="d-flex gap-2">
                                    <a href="@Url.Action("Index", "Users")" class="user-btn user-btn-secondary">
                                        <i class="fas fa-times me-1"></i>Cancel
                                    </a>
                                    <button type="submit" class="user-btn user-btn-primary">
                                        <i class="fas fa-save me-1"></i>Update User
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar Info -->
        <div class="col-lg-4">
            <div class="user-form-container">
                <div class="user-form-header">
                    <h5 class="user-form-title">
                        <i class="fas fa-info-circle me-2"></i>User Details
                    </h5>
                </div>
                <div class="user-form-body">
                    <div class="info-item mb-3">
                        <label class="info-label">User ID</label>
                        <div class="info-value">@Model.UserId.Substring(0, Math.Min(12, Model.UserId.Length))...</div>
                    </div>
                    <div class="info-item mb-3">
                        <label class="info-label">Created</label>
                        <div class="info-value">@Model.CreatedAt.ToString("MMM dd, yyyy HH:mm")</div>
                    </div>
                    <div class="info-item mb-3">
                        <label class="info-label">Status</label>
                        <div class="info-value">
                            @if (Model.IsActive)
                            {
                                <span class="user-badge active">Active User</span>
                            }
                            else
                            {
                                <span class="user-badge inactive">Inactive User</span>
                            }
                        </div>
                    </div>
                    <div class="info-item">
                        <label class="info-label">Role Permissions</label>
                        <div class="info-value">
                            @{
                                var roleDescription = Model.Role?.ToLower() switch
                                {
                                    "admin" => "Full system access and user management",
                                    "project manager" => "Project oversight and team coordination",
                                    "contractor" => "Project execution and task management",
                                    "client" => "Project viewing and communication",
                                    _ => "Basic user access"
                                };
                            }
                            <small style="color: rgba(255, 255, 255, 0.7);">@roleDescription</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include User Management CSS -->
<link rel="stylesheet" href="~/css/user-management.css" />

@section Scripts {
    <script>
        // Password confirmation validation
        document.getElementById('ConfirmNewPassword').addEventListener('input', function () {
            const newPassword = document.getElementById('NewPassword').value;
            const confirmPassword = this.value;
            const errorSpan = document.getElementById('passwordMatchError');

            if (confirmPassword && newPassword !== confirmPassword) {
                errorSpan.style.display = 'block';
            } else {
                errorSpan.style.display = 'none';
            }
        });

        // Form validation
        document.querySelector('form').addEventListener('submit', function (e) {
            const newPassword = document.getElementById('NewPassword').value;
            const confirmPassword = document.getElementById('ConfirmNewPassword').value;

            if (newPassword && confirmPassword && newPassword !== confirmPassword) {
                e.preventDefault();
                alert('New passwords do not match!');
                return false;
            }

            if (newPassword && newPassword.length < 6) {
                e.preventDefault();
                alert('New password must be at least 6 characters long!');
                return false;
            }
        });
    </script>
}
