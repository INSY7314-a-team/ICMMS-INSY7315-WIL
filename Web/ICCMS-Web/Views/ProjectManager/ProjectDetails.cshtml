@model ICCMS_Web.Models.ProjectDetailsViewModel
@{
    ViewData["Title"] = "Project Details";
    Layout = "_Layout";
}

<div class="container mt-4">
    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2 class="fw-bold mb-1">@Model.Project.Name</h2>
            <p class="text-muted mb-0">
                <i class="bi bi-person-fill text-primary me-1"></i>
                Client ID: <strong>@Model.Project.ClientId</strong> &nbsp; | &nbsp;
                Status: <strong>@Model.Project.Status</strong>
            </p>
        </div>
        <a asp-action="Dashboard" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left-circle me-1"></i> Back to Dashboard
        </a>
    </div>

    <!-- PROJECT INFO CARD -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
        <div class="card-body">
            <h5 class="fw-bold mb-3">Project Overview</h5>
            <p class="mb-1"><strong>Budget:</strong> R @Model.Project.BudgetPlanned.ToString("N0")</p>
            <p class="mb-1"><strong>Start:</strong> @Model.Project.StartDate.ToString("yyyy-MM-dd")</p>
            <p class="mb-1"><strong>End (Planned):</strong> @Model.Project.EndDatePlanned.ToString("yyyy-MM-dd")</p>
            @if (Model.Project.EndDateActual.HasValue)
            {
                <p class="mb-1"><strong>End (Actual):</strong> @Model.Project.EndDateActual.Value.ToString("yyyy-MM-dd")</p>
            }
            <hr />
            <p class="text-muted">@Model.Project.Description</p>
        </div>
    </div>

    <!-- NAV TABS -->
    <ul class="nav nav-tabs mt-4" id="projectTabs" role="tablist">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#overview">Overview</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#setup">Phases & Tasks</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#quotes">Quotes</a></li>
    </ul>

    <div class="tab-content mt-3">
        <!-- TAB 1: OVERVIEW -->
        <div class="tab-pane fade show active" id="overview">
            <h5 class="fw-bold mb-3">Project Summary</h5>
            <p>@Model.Project.Description</p>
            <p class="text-muted small mb-0">
                Created on: @Model.Project.StartDate.ToString("yyyy-MM-dd") |
                Status: <strong>@Model.Project.Status</strong>
            </p>
        </div>

        <!-- TAB 2: PHASES & TASKS -->
        <div class="tab-pane fade" id="setup">
            <h5 class="fw-bold mb-3">Phases & Tasks</h5>

            @if (Model.Phases.Any())
            {
                @foreach (var phase in Model.Phases)
                {
                    <div class="card mb-3 border-0 shadow-sm rounded-3">
                        <div class="card-header fw-bold bg-light">@phase.Name</div>
                        <ul class="list-group list-group-flush">
                            @foreach (var task in Model.Tasks.Where(t => t.PhaseId == phase.PhaseId))
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>@task.Name</strong>
                                        <div class="small text-muted">@task.Description</div>
                                    </div>
                                    <span class="badge bg-secondary">@task.Status</span>
                                </li>
                            }
                        </ul>
                    </div>
                }
            }
            else
            {
                <p class="text-muted fst-italic">No phases or tasks found.</p>
            }
        </div>

        <!-- TAB 3: QUOTES -->
        <div class="tab-pane fade" id="quotes">
            <h5 class="fw-bold mb-3">Linked Quotes</h5>

            @if (Model.Quotes.Any())
            {
                <div class="list-group">
                    @foreach (var q in Model.Quotes)
                    {
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>@q.Description</strong><br />
                                <small class="text-muted">Status: @q.Status</small>
                            </div>
                            <a href="@Url.Action("DownloadQuote", "Quotes", new { id = q.QuotationId })"
                               class="btn btn-outline-primary btn-sm" target="_blank">
                                <i class="bi bi-file-earmark-pdf me-1"></i> View PDF
                            </a>
                        </div>
                    }
                </div>
            }
            else
            {
                <p class="text-muted fst-italic">No quotes linked to this project.</p>
            }
        </div>
    </div>
</div>

<style>
    body {
        background-color: #f9fafc;
    }

    .card {
        border-radius: 1rem;
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 14px rgba(0,0,0,0.07);
    }

    .nav-tabs .nav-link.active {
        font-weight: 600;
        border-bottom: 2px solid #0d6efd;
    }

    .list-group-item {
        border: none;
        border-top: 1px solid #eee;
    }
</style>
