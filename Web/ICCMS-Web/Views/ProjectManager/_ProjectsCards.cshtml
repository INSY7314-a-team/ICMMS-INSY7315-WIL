@model List<ICCMS_Web.Models.ProjectDto>

@{
    // Get client map from ViewData if available
    var clientMap = ViewData["ClientMap"] as Dictionary<string, string> ?? new Dictionary<string, string>();
}

@foreach (var project in Model)
{
    // Provide safe fallbacks for ViewBag-dependent data inside _ProjectCard
    ViewBag.Phases = new List<ICCMS_Web.Models.PhaseDto>();
    ViewBag.Tasks = new List<ICCMS_Web.Models.ProjectTaskDto>();
    ViewBag.Estimate = null;
    ViewBag.Progress = 0;
    ViewBag.StatusBadgeClass = "badge-light";
    
    // Map client ID to client name, fallback to ClientId if not found
    var clientName = !string.IsNullOrEmpty(project.ClientId) && clientMap.ContainsKey(project.ClientId)
        ? clientMap[project.ClientId]
        : project.ClientId;
    ViewBag.ClientName = clientName;

    @await Html.PartialAsync("_ProjectCard", project)
}
